<!DOCTYPE html>
<html>
	<head>
		<link href="https://fonts.googleapis.com/css?family=Jua&display=swap" rel="stylesheet">
		<!-- 합쳐지고 최소화된 최신 CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

		<!-- 부가적인 테마 -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">

		<!-- 합쳐지고 최소화된 최신 자바스크립트 -->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
		<script data-ad-client="ca-pub-4080143543404581" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
		<!-- Go to www.addthis.com/dashboard to customize your tools -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-602c78a442a8c828"></script>
		<link rel="stylesheet" href="style.css">
	</head>
	<body onload="init()">
		<div class="container-fluid box">
		<!-- <div>Teachable Machine Image Model</div> -->
		<!--
        <button type="button" onclick="init()">Start</button>
		<button type="button" onclick="predict()">predict</button>
		-->
        <div id="webcam-container"></div>
        <div id="label-container"></div>
        <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
        <script type="text/javascript">
			const resultData = ["만져주는 걸 너무나 좋아하는 개냥이로 사람을 좋아하고 이름을 부르면 곧잘 대답해줍니다\n 따라다니면서 철푸덕 배를 보이며 발라당 드러누워 만져달라고 애교를 피우는 관종이에요\n하지만 엄청난 기분파! 원할 때에만 만져주길 바라요.\n호기심이 많고 처음 보는 사람에게도 낯을 잘 가리지 않아요\n그래서 외로움을 많이 타기 때문에 집을 오래 비우지 않도록 주의해주세요!\n밥을 있는대로 먹는 타입이므로 건강관리를 위해 집사는 식사양 조절을 해줍니다.\n또한 이사와 같은 환경 변화에 예민한 고양이이므로 스트레스를 조절해주세요.","사람에 대한 집착이 없고 외로움을 즐기는 야성미 넘치는 고양이\n독립심이 강하고 응석이 없어요\n그렇다고 사람을 싫어하는 건 아닙니다.\n고양이만의 사고방식을 가지고 살아가기 때문에, 간혹 사람이 이해하지 못 하는 행동을 잘 하는 편이에요\n모르는 사람에 대한 경계심이 강하고 낯을 많이 가려요\n하지만 가족에 대한 애착이 강하기 때문에 집사를 지켜주려고 합니다.\n자기관리를 잘 하는 타입이기 때문에 건강을 크게 걱정하지 않아도 되겠어요.","취향과 입맛이 까다로운 똑똑한 고양이\n소란스러운 행동을 피하고 요령을 피우기 때문에 사냥놀이도 머리를 쓰며 하는 편이에요\n소음에 예민하기 때문에 사람의 팔에 안기거나 조용히 빈둥거리며 시간을 보내길 좋아해요\n그렇기 때문에 휴식을 취할 안락한 장소를 마련해주면 좋습니다\n취향이 확고하고 특히 먹이에 대한 호불호가 강하기 때문에 \n싫어서 먹지 않는지 몸이 안 좋은아서 먹지 않는지에 대한 예리한 판단이 필요해요\n늘 건강 체크를 잘 해줘야겠어요.","겁이 많고 소심한 성격으로 낯선 사람과 변화가 너무나 싫은 고양이\n낯을 많이 가리기 때문에 오직 집사와만 친하게 지내고 싶어요\n탐험심도 없고 겁이 많아서 작은 소리에도 놀라 어딘가에 숨어버리곤 해요\n집사는 이런 츤데레한 매력에서 헤어나오지 못 하게 됩니다.\n자기관리가 잘 되지 않아서 과식으로 인한 구토도 종종하기 때문에\n간식을 적당히 주어 건강 관리를 해주어야겠어요.","자기 주장이 확실한 행동파 고양이\n집사에게 갑자기 화를 벌컥 낸다거나 불만을 표출하여 놀라게 하기도 합니다.\n자존감이 높기 때문에 집착을 하진 않지만, 불만이 지속되면 마음을 완전히 닫아버리기도 하기 때문에\n섬세하게 살펴주어야 합니다.\n관찰하는 것을 좋아하기 때문에 가족내의 권력관계를 빠르게 파악하기도 하고\n다른 고양이보다 창밖 세상에 대한 호기심이 많기 때문에 밖이 잘 보이도록 환경을 만들어줍니다.\n의외로 몸이 약한 고양이가 많기 때문에 건강 관리를 신경써야겠어요."
];
			
            // More API functions here:
            // https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/image

            // the link to your model provided by Teachable Machine export panel
            //const URL = 'https://teachablemachine.withgoogle.com/models/sytupsddY/';
			const URL = 'https://teachablemachine.withgoogle.com/models/0sES-tv8u/';
            let model, labelContainer, maxPredictions;

            // Load the image model and setup the webcam
            async function init() {
                const modelURL = URL + 'model.json';
                const metadataURL = URL + 'metadata.json';

                // load the model and metadata
                // Refer to tmImage.loadFromFiles() in the API to support files from a file picker
                // or files from your local hard drive
                // Note: the pose library adds "tmImage" object to your window (window.tmImage)
                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();

                // append elements to the DOM
                labelContainer = document.getElementById('label-container');
                for (let i = 0; i < maxPredictions; i++) {
                    // and class labels
                    labelContainer.appendChild(document.createElement('div'));
                }
            }

            // run the webcam image through the image model
            async function predict() {
                // predict can take in an image, video or canvas html element
				var uploadImg = document.getElementById('uploadImg');
                const prediction = await model.predict(uploadImg, false);
				const arrayList = [0, 0, 0, 0, 0];
				
                for (let i = 0; i < maxPredictions; i++) {
					/*
                    const classPrediction =
                        prediction[i].className + ': ' + prediction[i].probability.toFixed(2);
                    labelContainer.childNodes[i].innerHTML = classPrediction;
					*/
					
					if(prediction[i].className === 'A'){
						console.log('A : ' + prediction[i].probability.toFixed(2)*100);
						arrayList[0] = prediction[i].probability.toFixed(2)*100;
						document.getElementById('proA').style.width = prediction[i].probability.toFixed(2)*100 + '%';
						document.getElementById('proA').setAttribute('aria-valuenow', prediction[i].probability.toFixed(2)*100 );
						// document.getElementById('proA').childNodes[0].innerHTML =  prediction[i].probability.toFixed(2)*100 + '%';
						document.getElementById('proA').children[0].innerHTML =  prediction[i].probability.toFixed(2)*100 + '%';
					}else if(prediction[i].className === 'B'){
						console.log('B : ' + prediction[i].probability.toFixed(2)*100);
						arrayList[1] = prediction[i].probability.toFixed(2)*100;
						document.getElementById('proB').style.width = prediction[i].probability.toFixed(2)*100 + '%';
						document.getElementById('proB').setAttribute('aria-valuenow', prediction[i].probability.toFixed(2)*100 );
						document.getElementById('proB').children[0].innerHTML =  prediction[i].probability.toFixed(2)*100 + '%';
					}else if(prediction[i].className === 'C'){
						console.log('C : ' + prediction[i].probability.toFixed(2)*100);
						arrayList[2] = prediction[i].probability.toFixed(2)*100;
						document.getElementById('proC').style.width = prediction[i].probability.toFixed(2)*100 + '%';
						document.getElementById('proC').setAttribute('aria-valuenow', prediction[i].probability.toFixed(2)*100 );
						document.getElementById('proC').children[0].innerHTML =  prediction[i].probability.toFixed(2)*100 + '%';
					}else if(prediction[i].className === 'D'){
						console.log('D : ' + prediction[i].probability.toFixed(2)*100);
						arrayList[3] = prediction[i].probability.toFixed(2)*100;
						document.getElementById('proD').style.width = prediction[i].probability.toFixed(2)*100 + '%';
						document.getElementById('proD').setAttribute('aria-valuenow', prediction[i].probability.toFixed(2)*100 );
						document.getElementById('proD').children[0].innerHTML =  prediction[i].probability.toFixed(2)*100 + '%';
					}else if(prediction[i].className === 'E'){
						console.log('E : ' + prediction[i].probability.toFixed(2)*100);
						arrayList[4] = prediction[i].probability.toFixed(2)*100;
						document.getElementById('proE').style.width = prediction[i].probability.toFixed(2)*100 + '%';
						document.getElementById('proE').setAttribute('aria-valuenow', prediction[i].probability.toFixed(2)*100 );
						document.getElementById('proE').children[0].innerHTML =  prediction[i].probability.toFixed(2)*100 + '%';
					}
                }
				
				var maxType = arrayList.reduce( function(previous, current, i) { 
					// return previous > current ? previous:current;
					return previous > current ? i:i-1;
				});
				console.log("maxType : " + maxType);
				console.log(resultData[maxType-1]);
				document.getElementById('resultBox').innerHTML = resultData[maxType-1];
            }
        </script>

        <script
            class="jsbin"
            src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"
        ></script>
        <script>
            function readURL(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        $('.image-upload-wrap').hide();

                        $('.file-upload-image').attr('src', e.target.result);
                        $('.file-upload-content').show();

                        $('.image-title').html(input.files[0].name);
						//업로드 완료시점
						predict();
                    };

                    reader.readAsDataURL(input.files[0]);
                } else {
                    removeUpload();
                }
            }

            function removeUpload() {
                $('.file-upload-input').replaceWith($('.file-upload-input').clone());
                $('.file-upload-content').hide();
                $('.image-upload-wrap').show();
            }
            $('.image-upload-wrap').bind('dragover', function () {
                $('.image-upload-wrap').addClass('image-dropping');
            });
            $('.image-upload-wrap').bind('dragleave', function () {
                $('.image-upload-wrap').removeClass('image-dropping');
            });
        </script>
        <div class="file-upload">
            <button
                class="file-upload-btn"
                type="button"
                onclick="$('.file-upload-input').trigger( 'click' )"
            >
                젤리 업로드
            </button>

            <div class="image-upload-wrap">
                <input
                    class="file-upload-input"
                    type="file"
                    onchange="readURL(this);"
                    accept="image/*"
                />
                <div class="drag-text">
                    <h3>고양이가 주로 사용하는 발의 젤리 사진을 올려주세요</h3>
                </div>
            </div>
            <div class="file-upload-content">
                <img id="uploadImg" class="file-upload-image" src="#" alt="your image" />
                <div class="image-title-wrap">
                    <button type="button" onclick="removeUpload()" class="remove-image">
                        사진 삭제 <span class="image-title">Uploaded Image</span>
                    </button>
                </div>
            </div>
        </div>
		
		
		
		<div class="">
			<!-- <div>
				<span class="label label-default">Default</span>
			</div> -->
			<div class="row form-group">
				<div class="col-xs-3 col-sm-2 col-md-2">
					<span class="text-success">개냥이</span><!-- A타입 -->
				</div>
				<div class="col-xs-9 col-sm-10 col-md-10 progress">
				  <div id="proA" class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%">
					<span></span>
				  </div>
				</div>
			</div>
			
			<div class="row">
				<div class="col-xs-3 col-sm-2 col-md-2">
					<span class="text-info">독립냥</span><!-- B타입 -->
				</div>
				<div class="col-xs-9 col-sm-10 col-md-10 progress">
				  <div id="proB" class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
					<span></span>
				  </div>
				</div>
			</div>
			
			<div class="row">
				<div class="col-xs-3 col-sm-2 col-md-2">
					<span class="text-warning">까칠냥</span><!-- C타입 -->
				</div>
				<div class="col-xs-9 col-sm-10 col-md-10 progress">
				  <div id="proC" class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
					<span></span>
				  </div>
				</div>
			</div>
			
			<div class="row">
				<div class="col-xs-3 col-sm-2 col-md-2">
					<span class="text-danger">쫄보냥</span><!-- D타입 -->
				</div>
				<div class="col-xs-9 col-sm-10 col-md-10 progress">
				  <div id="proD" class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
					<span></span>
				  </div>
				</div>
			</div>
			
			<div class="row">
				<div class="col-xs-3 col-sm-2 col-md-2">
					<span class="text-primary">행동파냥</span><!-- E타입 -->
				</div>
				<div class="col-xs-9 col-sm-10 col-md-10 progress">
				  <div id="proE" class="progress-bar progress-bar-default" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
					<span></span>
				  </div>
				</div>
			</div>
			<div id="resultBox">
				
			</div>
			<!-- Go to www.addthis.com/dashboard to customize your tools -->
			<div class="addthis_inline_share_toolbox"></div>
		</div>
    </body>
    <!-- Copyright (c) 2021 by Aaron Vanston (https://codepen.io/aaronvanston/pen/yNYOXR)

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
--></html>